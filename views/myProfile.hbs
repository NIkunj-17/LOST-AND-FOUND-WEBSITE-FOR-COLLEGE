<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile | IIIT Raichur Lost & Found</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .mySection {
            padding: 35px;
        }
        .user-info{
            width: 30%;
            background-color: white;
            height: 150px;
            color: black;
            margin: 0 auto;
            margin-top: 50px;
            text-align: center;
            padding: 15px;
            box-sizing: border-box;
            border-radius: 20px;
            font-size: large;
            font-weight: bold;
        }
        .user-info img{
            margin-right: 20px;
            height: 80px;
            margin-bottom: 0;
        }
        .user-info p {
            font-size: large;
            padding-top: 5px;
        } 
        .mySection{
            margin: 10px;
        }
         .new-div{
            background-color: black;
            color: white;
            text-align: center;
            margin: 10px;
            margin-top: 0;
            display: flex;
            padding-bottom: 25px;
            padding-top: 20px;
        }
        
    </style>
</head>
<body>
    </header>
      <header>
        <div class="nav-container">
    <nav>
        <ul>
            <li><img src="iiit-raichur-logo.png" height="80px"></li>
           <li class="link"><a href="/home">Home</a></li>
            <li class="link"><a href="/about">About</a></li>
            <li class="link"><a href="/contact">Contact</a></li>
        </ul>
    </nav>
    <div >
        <p class="m-5"><a href="/myProfile"><img \ src="profile.png" height="53px"alt=""></a>
        <span >Profile</span>
        </p>
    </div>
</div>
    </header>

    <div class="user-info">
            <p><img src="hello.png" height="50px"> {{data.name}}</p>
            <p>Email: {{data.email}}</p>
            <a href="/logout"><button class="btn btn-danger" onclick="logout()">Logout</button></a>
        </div>

     <!--My Items-->
        <section class="mt-5 mySection">
            <div class="row">
                <div class="new-div row">
                <h2 style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight:800"> MY LOST ITEMS</h2>
                {{#each myImages}} 
                    {{#each this}}
                        {{#if imageBase64 }}
                            <div class="col-md-4 mt-3">
                                <div class="card shadow">
                                    <div><img src='data:{{contentType}};base64,{{imageBase64}}' class="card-img-top" alt="..."></div>
                                    <div class="card-body text-center" id="card-detail">
                                        <h5 class="card-title font-poppins">Item Name: {{title}}</h5>
                                        <p class="card-text">Description: {{descriptions}}</p> 
                                        
                                         {{#if receivedBool}}
                                                <a href="#" class="btn btn-primary" style="width: 120px"
                                        disabled >Received</a>
                                         {{else}}
                                                <a href="#" class="btn btn-primary" style="width: 120px"
                                        onclick="Received('{{_id}}', '{{foundPersonName}}', '{{foundPersonEmail}}')">Click to Receive</a>
                                         {{/if}}</a>
                                    </div>
                                </div>
                            </div>
                        {{/if}}
                    {{/each}}
                {{/each}}
                </div>
            </div>
        </section>
         <footer class="footer">
    <div class="container">
        <span>Â© 2024 IIIT Raichur Lost & Found</span>
    </div>
</footer>
          
         <!-- Popup Window HTML -->
    <div class="popup" id="popup">
        <div class="popup-content">
           
        </div>
    </div>

       <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

     <script>

        function Received(id,foundPersonName,foundPersonEmail) {
            console.log(id);
            document.getElementsByClassName('popup-content')[0].innerHTML = `
               <h2>Recieved Item Details<a href="#" class="btn btn-danger" style="float: right;" onclick="closePopup()">X</a></h2>
                 <p>Founder Email: ${foundPersonEmail}</p>
                <p>Founder Name: ${foundPersonName}</p>
                <label>
                <input type="checkbox" id="contactCheckbox"> I have Successfully Received my Item.
                </label>
                <button onclick="handleReceive('${id}')">Recieved</button>
                `;
            document.getElementById("popup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
            
        }
        function closePopup() {
    document.getElementById("popup").style.display = "none";
    document.getElementById("overlay").style.display = "none";
    }
         async function handleReceive(id) {
            // Handle checkbox state and action
            let contactCheckbox = document.getElementById("contactCheckbox");
            if (contactCheckbox.checked) {
                document.getElementById("card-detail").querySelector("a").innerHTML = "Received";
                    changeBody = {
                            "_id": id,
                            "receivedBool": true
                    };
                    const bodyString = JSON.stringify(changeBody);
                    await fetch("/updateDetails", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: bodyString
                    });

            } else {
                window.alert("Check the checkbox first !");
            }

            // Close the popup after handling action
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        async function handleContact(id) {
            // Handle checkbox state and action
            let contactCheckbox = document.getElementById("contactCheckbox");
            if (contactCheckbox.checked) {

                await fetch("/profile").then(async (response) => await response.json())
                .then(async (profile) => {
                    console.log(profile.user.email + "  Change kar de");
                    changeBody = {
                        "_id": id,
                        "foundPersonName": profile.user.name,
                        "foundPersonEmail": profile.user.email,
                        "foundBool": true
                    };
                    const bodyString = JSON.stringify(changeBody);
                    await fetch("/updateDetails", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: bodyString
                    });
                });

            } else {
                window.alert("Check the checkbox first !");
            }

            // Close the popup after handling action
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        function logout() {
              alert("Logged-Out Successfull");
        }

    </script>
    
</body>
</html>