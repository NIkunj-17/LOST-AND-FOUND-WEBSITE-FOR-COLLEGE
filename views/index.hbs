<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIIT Raichur Lost & Found</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-purple">
   
      <header>
        <div class="nav-container">
    <nav>
        <ul>
            <li><img src="iiit-raichur-logo.png" height="50px"></li>
           <li class="link"><a href="/home">Home</a></li>
            <li class="link"><a href="/about">About</a></li>
            <li class="link"><a href="/contact">Contact</a></li>
        </ul>
    </nav>
    <div>
        <p class="m-5"><a href="/myProfile"><img \ src="profile.png" height="53px"alt=""></a>
        <span >Profile</span>
        </p>
    </div>
</div>

    </header>
    <div class="container py-0">
        <div class="row justify-content-center mt-5">
            <div class="col-md-6">
                <form action="/upload" enctype="multipart/form-data" method="POST" id="form">
                    <div class="new-div div2">
                        <p>Lost Something? Upload Here</p>
                    </div>
                    <div class="mb-3">
                        <input type="file" class="form-control" name="images" id="formFile" multiple>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="title" placeholder="Lost Item">
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="descriptions[]" placeholder="About your lost item...">
                    </div>
                   <div class="text-center">
    <button type="submit" class="btn btn-success btn1">Upload</button>
</div>

                </form>
            </div>
        </div>

        <!-- Display Images Section -->
        <section class="mt-5 mb-5">
            <div class="row">
                <div class="new-div row">
                <h2 style="font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight:800" class="my-3">Click Found & Make Someone's Day! </h2>
                {{#each images}} 
                    {{#each this}}
                        {{#if imageBase64 }}
                            <div class="col-md-4 col-sm-6 mb-4">
                                <div class="card h-100 border-0 shadow">
                                    <img src='data:{{contentType}};base64,{{imageBase64}}' class="card-img-top" alt="...">
                                    <div class="card-body text-center">
                                        <h5 class="card-title font-poppins mb-0">Item Name: {{title}}</h5>
                                        <p class="card-text text-muted mt-2 mb-4">Description :{{descriptions}}</p>
                                        <a href="#" class="btn btn-primary" onclick="openPopup('{{_id}}','{{userName}}', '{{email}}')">FOUND</a>
                                    </div>
                                </div>
                            </div>
                        {{/if}}
                    {{/each}}
              {{/each}}
                </div>     
            </div> 
        </section>
    </div>
   <footer class="footer">
    <div class="container">
        <span>Â© 2024 IIIT Raichur Lost & Found</span>
    </div>
</footer>


    <!-- Popup Window HTML -->
    <div class="popup" id="popup">
        <div class="popup-content">
        </div>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
   

    <!-- JavaScript to handle popup action -->
    <script>
        const form = document.getElementById("form");

        form.addEventListener("submit", function(event) {
        event.preventDefault();

        // Get the form data
        const formData = new FormData(form);
        fetch("/profile").then((response) => response.json())
            .then((profile) => {
                console.log(profile.user.name);
                // Add additional values and keys to the form data
                    formData.append("name", profile.user.name);
                    formData.append("email", profile.user.email);

                // Send the form data using the POST request
                    fetch("/upload", {
                        method: "POST",
                        body: formData
                    });
            });
        });

        function openPopup(id,name,email) {
            console.log(id);
            document.getElementsByClassName('popup-content')[0].innerHTML = `
                <h2>Found Item Details<a href="#" class="btn btn-danger" style="float: right;" onclick="closePopup()">X</a></h2>
            <p>Email: ${email}</p>
                <p>Name: ${name}</p>
            <label>
                <input type="checkbox" id="contactCheckbox"> I will contact the owner
            </label>
            <button onclick="handleContact('${id}')">Submit</button>
                `;
            document.getElementById("popup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }
        function closePopup() {
    document.getElementById("popup").style.display = "none";
    document.getElementById("overlay").style.display = "none";
    }


        function Received(id,foundPersonName,foundPersonEmail) {
            console.log(id);
            document.getElementsByClassName('popup-content')[0].innerHTML = `
                <h2>Receiving Item Details</h2>
                 <p>Founder Email: ${foundPersonEmail}</p>
                <p>Founder Name: ${foundPersonName}</p>
                <label>
                <input type="checkbox" id="contactCheckbox"> I have Successfully Received my Item.
                </label>
                <button onclick="handleReceive('${id}')">Recieved</button>
                `;
            document.getElementById("popup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
            document.getElementById("card-detail").querySelector("a").innerHTML = "Reveived";
        }
         async function handleReceive(id) {
            // Handle checkbox state and action
            let contactCheckbox = document.getElementById("contactCheckbox");
            if (contactCheckbox.checked) {

                    changeBody = {
                            "_id": id,
                            "receivedBool": true
                    };
                    const bodyString = JSON.stringify(changeBody);
                    await fetch("/updateDetails", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: bodyString
                    });

            } else {
                window.alert("Check the checkbox first !");
            }

            // Close the popup after handling action
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        async function handleContact(id) {
            // Handle checkbox state and action
            let contactCheckbox = document.getElementById("contactCheckbox");
            if (contactCheckbox.checked) {

                await fetch("/profile").then(async (response) => await response.json())
                .then(async (profile) => {
                    console.log(profile.user.email + "  Change kar de");
                    changeBody = {
                        "_id": id,
                        "foundPersonName": profile.user.name,
                        "foundPersonEmail": profile.user.email,
                        "foundBool": true
                    };
                    const bodyString = JSON.stringify(changeBody);
                    await fetch("/updateDetails", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: bodyString
                    });
                });

            } else {
                window.alert("Check the checkbox first !");
            }

            // Close the popup after handling action
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
    </script>
</body>
</html>